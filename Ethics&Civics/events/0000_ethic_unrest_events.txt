namespace = unrest

situation_event = {
	id = unrest.100
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		situation_progress > 25
		NOT = { has_situation_flag = 25_percent_event }
	}

	immediate = {
		set_situation_flag = 25_percent_event

		target = {
			set_timed_planet_flag = {
				flag = recent_unrest_event
				days = @unrest_event_cooldown
			}
			random_list = {
				1 = {
					planet_event = { id = unrest.115 }
					root = { set_situation_flag = spiritualist }
					modifier = {
						factor = 0
						NOT = {
							any_owned_pop = {
								has_ethic = ethic_spiritualist
							}
						}
					}
					complex_trigger_modifier = {
						trigger = count_owned_pop
						parameters = {
							limit = { has_ethic = ethic_spiritualist }
						}
						mode = add
					}
					modifier = {
						factor = 0.5
						owner = { is_spiritualist = yes }
					}
				}
				1 = {
					planet_event = { id = unrest.120 }
					root = { set_situation_flag = authoritarian }
					modifier = {
						factor = 0
						NOT = {
							any_owned_pop = {
								has_ethic = ethic_authoritarian
							}
						}
					}
					complex_trigger_modifier = {
						trigger = count_owned_pop
						parameters = {
							limit = { has_ethic = ethic_authoritarian }
						}
						mode = add
					}
					modifier = {
						factor = 0.5
						owner = { is_authoritarian = yes }
					}
					modifier = {
						factor = 0.5
						owner = { has_authority = auth_imperial }
					}
					modifier = {
						factor = 2
						owner = { has_authority = auth_democratic }
					}
				}
				1 = {
					planet_event = { id = unrest.125 }
					root = { set_situation_flag = xenophobe }
					modifier = {
						factor = 0
						NOT = {
							any_owned_pop = {
								has_ethic = ethic_xenophobe
							}
						}
					}
					complex_trigger_modifier = {
						trigger = count_owned_pop
						parameters = {
							limit = { has_ethic = ethic_xenophobe }
						}
						mode = add
					}
					modifier = {
						factor = 0
						owner = { has_comms_with_alien_empire = no }
					}
					modifier = {
						factor = 0.25
						NOT = {
							any_owned_pop = {
								NOT = { is_same_species = owner }
								pop_has_happiness = no
							}
						}
					}
					modifier = {
						factor = 0.5
						owner = { is_xenophobe = yes }
					}
					modifier = {
						factor = 0.5
						is_majority_species = owner
					}
					modifier = {
						factor = 2
						NOT = { is_majority_species = owner }
					}
				}
				1 = {
					planet_event = { id = unrest.130 }
					root = { set_situation_flag = spiritualist }
					modifier = {
						factor = 0
						NOT = {
							any_owned_pop = {
								has_ethic = ethic_materialist
							}
						}
					}
					complex_trigger_modifier = {
						trigger = count_owned_pop
						parameters = {
							limit = { has_ethic = ethic_materialist }
						}
						mode = add
					}
					modifier = {
						factor = 0.5
						owner = { is_materialist = yes }
					}
				}
				1 = {
					planet_event = { id = unrest.135 }
					root = { set_situation_flag = xenophile }
					modifier = {
						factor = 0
						owner = { has_comms_with_alien_empire = no }
					}
					modifier = {
						factor = 0
						NOT = {
							any_owned_pop = {
								has_ethic = ethic_xenophile
							}
						}
					}
					modifier = {
						factor = 0.25
						NOT = {
							any_owned_pop = {
								NOT = { is_same_species = owner }
								pop_has_happiness = no
							}
						}
					}
					complex_trigger_modifier = {
						trigger = count_owned_pop
						parameters = {
							limit = { has_ethic = ethic_xenophile }
						}
						mode = add
					}
					modifier = {
						factor = 0.5
						owner = { is_xenophile = yes }
					}
				}
				1 = {
					planet_event = { id = unrest.140 }
					root = { set_situation_flag = egalitarian }
					modifier = {
						factor = 0
						NOT = {
							any_owned_pop = {
								has_ethic = ethic_egalitarian
							}
						}
					}
					complex_trigger_modifier = {
						trigger = count_owned_pop
						parameters = {
							limit = { has_ethic = ethic_egalitarian }
						}
						mode = add
					}
					modifier = {
						factor = 0.5
						owner = { is_egalitarian = yes }
					}
					modifier = {
						factor = 0.5
						owner = { has_authority = auth_democratic }
					}
					modifier = {
						factor = 2
						owner = { has_authority = auth_imperial }
					}
				}
				1 = {
					planet_event = { id = unrest.145 }
					root = { set_situation_flag = pacifist }
					modifier = {
						factor = 0
						NOT = {
							any_owned_pop = {
								has_ethic = ethic_pacifist
							}
						}
					}
					complex_trigger_modifier = {
						trigger = count_owned_pop
						parameters = {
							limit = { has_ethic = ethic_pacifist }
						}
						mode = add
					}
					modifier = {
						factor = 0.5
						owner = { is_pacifist = yes }
					}
					modifier = {
						factor = 2
						owner = { is_at_war = yes }
					}
				}
				1 = {
					planet_event = { id = unrest.150 }
					root = { set_situation_flag = militarist }
					modifier = {
						factor = 0
						NOT = {
							any_owned_pop = {
								has_ethic = ethic_militarist
							}
						}
					}
					complex_trigger_modifier = {
						trigger = count_owned_pop
						parameters = {
							limit = { has_ethic = ethic_militarist }
						}
						mode = add
					}
					modifier = {
						factor = 0.5
						owner = { is_militarist = yes }
					}
					modifier = {
						factor = 0.75
						owner = { is_at_war = yes }
					}
				}
				1 = {
					planet_event = { id = unrest.5000 }
					root = { set_situation_flag = socialism }
					modifier = {
						factor = 0
						NOT = {
							any_owned_pop = {
								has_ethic = ethic_socialism
							}
						}
					}
					complex_trigger_modifier = {
						trigger = count_owned_pop
						parameters = {
							limit = { has_ethic = ethic_socialism }
						}
						mode = add
					}
					modifier = {
						factor = 0.5
						owner = { is_socialism = yes }
					}
				}
				1 = {
					planet_event = { id = unrest.6000 }
					root = { set_situation_flag = capitalism }
					modifier = {
						factor = 0
						NOT = {
							any_owned_pop = {
								has_ethic = ethic_capitalism
							}
						}
					}
					complex_trigger_modifier = {
						trigger = count_owned_pop
						parameters = {
							limit = { has_ethic = ethic_capitalism }
						}
						mode = add
					}
					modifier = {
						factor = 0.5
						owner = { is_capitalism = yes }
					}
				}
				1 = {
					if = {
						limit = {
							owner = { is_hive_empire = yes }
						}
						root = { set_situation_flag = hive }
					}
					else_if = {
						limit = {
							owner = { is_machine_empire = yes }
						}
						root = { set_situation_flag = machine }
					}
					#Nothing else. We don't really need an event here for them.

					modifier = {
						factor = 0
						OR = {
							owner = { is_gestalt = no }
							count_owned_pop = {
								limit = {
									NOT = { has_ethic = ethic_gestalt_consciousness }
								}
								count = 0
							}
						}
					}
				}
			}
		}
	}
}

# Unrest: Terror
planet_event = {
	id = unrest.101
	title = unrest.101.name
	desc = unrest.101.desc
	picture = GFX_evt_night_raid
	show_sound = event_air_raid_siren
	location = root

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
	}
	trigger = {
		owner = {
			is_country_type = default
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
		exists = controller
		controller = { is_same_value = root.owner }
		has_orbital_bombardment = no
		planet_stability < @stabilitylevel2
		NOR = {
			has_planet_flag = recent_unrest_event
			OR = {
				has_modifier = riots_averted
				has_modifier = spiritualist_unrest
				has_modifier = authoritarian_unrest
				has_modifier = materialist_unrest
				has_modifier = xenophobe_unrest
				has_modifier = xenophile_unrest
				has_modifier = pacifist_unrest
				has_modifier = militarist_unrest
				has_modifier = authoritarian_unrest
				has_modifier = egalitarian_unrest
				has_modifier = major_terrorist_action
				has_modifier = minor_terrorist_action
			}
		}
	}

	mean_time_to_happen = {
		years = 50
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel2
		}	
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel1
		}
	}

	immediate = {
		add_modifier = {
			modifier = minor_terrorist_action
			days = 7200 # 20 years
		}
		set_timed_planet_flag = {
			flag = recent_unrest_event
			days = 720
		}
		set_timed_planet_flag = {
			flag = unrest_terror
			days = 7200
		}
	}

	option = {
		name = UNFORTUNATE
		tooltip = {
			add_modifier = {
				modifier = minor_terrorist_action
				days = 7200 # 20 years
			}
		}
	}
}

# calc_true_if check for having too many modifiers?

# Unrest: Severe Terror
planet_event = {
	id = unrest.105
	title = unrest.105.name
	desc = unrest.105.desc
	picture = GFX_evt_night_raid
	show_sound = event_air_raid_siren
	location = root

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
	}

	trigger = {
		owner = { 
			is_country_type = default
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
		exists = controller
		controller = { is_same_value = root.owner }
		has_planet_flag = unrest_terror
		planet_stability < @stabilitylevel2
		has_orbital_bombardment = no
	}

	mean_time_to_happen = {
		years = 50
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel2
		}	
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel1
		}
		modifier = {
			factor = 0.8
			has_planet_flag = unrest_terror 
		}
	}

	immediate = {
		add_modifier = {
			modifier = major_terrorist_action
			days = 3600 # 10 years
		}
		set_timed_planet_flag = {
			flag = recent_unrest_event
			days = 720
		}
	}

	option = {
		name = UNFORTUNATE
		tooltip = {
			add_modifier = {
				modifier = major_terrorist_action
				days = 3600 # 10 years
			}
		}
	}
}

# Unrest : Keeping the Peace
planet_event = {
	id = unrest.110
	title = unrest.110.name
	desc = unrest.110.desc
	picture = GFX_evt_announcement
	show_sound = event_announcement
	location = root

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
	}

	trigger = {
		has_orbital_bombardment = no
		owner = {
			is_country_type = default
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
		exists = controller
		controller = { is_same_value = root.owner }
		planet_stability < @stabilitylevel2
		planet_stability >= @stabilitylevel1
		NOR = {
			has_planet_flag = recent_unrest_event
			OR = {
				has_modifier = riots_averted
				has_modifier = spiritualist_unrest
				has_modifier = authoritarian_unrest
				has_modifier = materialist_unrest
				has_modifier = xenophobe_unrest
				has_modifier = xenophile_unrest
				has_modifier = pacifist_unrest
				has_modifier = militarist_unrest
				has_modifier = authoritarian_unrest
				has_modifier = egalitarian_unrest
				has_modifier = capitalism_unrest
				has_modifier = socialism_unrest
				has_modifier = major_terrorist_action
				has_modifier = minor_terrorist_action
			}
		}
	}

	mean_time_to_happen = {
		years = 50
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel2
		}	
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel1
		}
	}

	immediate = {
		add_modifier = {
			modifier = riots_averted
			days = 7200 # 20 years
		}
		set_timed_planet_flag = {
			flag = recent_unrest_event
			days = 720
		}
	}

	option = {
		name = OK
		tooltip = {
			add_modifier = { 
				modifier = riots_averted
				days = 7200 # 20 years
			}
		}
	}
}
# Unrest: Hallowed
planet_event = {
	id = unrest.115
	title = unrest.115.name
	desc = unrest.115.desc
	picture = GFX_evt_conclave
	show_sound = event_mystic_reveal
	location = root

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
	}

	trigger = {
		has_orbital_bombardment = no
		owner = {
			is_country_type = default
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
		exists = controller
		controller = { is_same_value = root.owner }
		planet_stability < @stabilitylevel2
		NOR = {
			has_planet_flag = recent_unrest_event
			OR = {
				has_modifier = riots_averted
				has_modifier = spiritualist_unrest
				has_modifier = authoritarian_unrest
				has_modifier = materialist_unrest
				has_modifier = xenophobe_unrest
				has_modifier = xenophile_unrest
				has_modifier = pacifist_unrest
				has_modifier = militarist_unrest
				has_modifier = authoritarian_unrest
				has_modifier = egalitarian_unrest
				has_modifier = capitalism_unrest
				has_modifier = socialism_unrest
				has_modifier = major_terrorist_action
				has_modifier = minor_terrorist_action
			}
		}
	}

	mean_time_to_happen = {
		years = 50
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel2
		}	
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel1
		}
	}

	immediate = {
		add_modifier = {
			modifier = spiritualist_unrest
			days = 7200 # 20 years
		}
		set_timed_planet_flag = {
			flag = recent_unrest_event
			days = 720
		}
	}

	option = {
		name = OK
		tooltip = {
			add_modifier = {
				modifier = spiritualist_unrest
				days = 7200 # 20 years
			}
		}
	}
}

planet_event = {
	id = unrest.120
	title = unrest.120.name
	desc = unrest.120.desc
	picture = GFX_evt_alien_propaganda
	show_sound = event_celebration
	location = root

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
	}

	trigger = {
		has_orbital_bombardment = no
		owner = {
			is_country_type = default
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
		exists = controller
		controller = { is_same_value = root.owner }
		planet_stability < @stabilitylevel2
		NOR = {
			has_planet_flag = recent_unrest_event
			OR = {
				has_modifier = riots_averted
				has_modifier = spiritualist_unrest
				has_modifier = authoritarian_unrest
				has_modifier = materialist_unrest
				has_modifier = xenophobe_unrest
				has_modifier = xenophile_unrest
				has_modifier = pacifist_unrest
				has_modifier = militarist_unrest
				has_modifier = authoritarian_unrest
				has_modifier = egalitarian_unrest
				has_modifier = capitalism_unrest
				has_modifier = socialism_unrest
				has_modifier = major_terrorist_action
				has_modifier = minor_terrorist_action
			}
		}
	}

	mean_time_to_happen = {
		years = 50
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel2
		}	
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel1
		}
	}

	immediate = {
		add_modifier = {
			modifier = authoritarian_unrest
			days = 7200 # 20 years
		}
		set_timed_planet_flag = {
			flag = recent_unrest_event
			days = 720
		}
	}

	option = {
		name = OK
		tooltip = {
			add_modifier = {
				modifier = authoritarian_unrest
				days = 7200 # 20 years
			}
		}
	}
}

planet_event = {
	id = unrest.125
	title = unrest.125.name
	desc = unrest.125.desc
	picture = GFX_evt_alien_segregation
	show_sound = event_public_unrest
	location = root

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
	}

	trigger = {
		has_orbital_bombardment = no
		owner = {
			is_country_type = default
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
		exists = controller
		controller = { is_same_value = root.owner }
		planet_stability < @stabilitylevel2
		NOR = {
			has_planet_flag = recent_unrest_event
			OR = {
				has_modifier = riots_averted
				has_modifier = spiritualist_unrest
				has_modifier = authoritarian_unrest
				has_modifier = materialist_unrest
				has_modifier = xenophobe_unrest
				has_modifier = xenophile_unrest
				has_modifier = pacifist_unrest
				has_modifier = militarist_unrest
				has_modifier = authoritarian_unrest
				has_modifier = egalitarian_unrest
				has_modifier = capitalism_unrest
				has_modifier = socialism_unrest
				has_modifier = major_terrorist_action
				has_modifier = minor_terrorist_action
			}
		}
		any_owned_pop = {
			NOT = {
				is_same_species = owner
			}
		}
		any_owned_pop = {
			is_same_species = owner
		}
		
	}

	mean_time_to_happen = {
		years = 50
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel2
		}	
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel1
		}
	}

	immediate = {
		add_modifier = {
			modifier = xenophobe_unrest
			days = 7200 # 20 years
		}
		set_timed_planet_flag = {
			flag = recent_unrest_event
			days = 720
		}
	}

	option = {
		name = OK
		tooltip = {
			add_modifier = {
				modifier = xenophobe_unrest
				days = 7200 # 20 years
			}
		}
	}
}

planet_event = {
	id = unrest.130
	title = unrest.130.name
	desc = unrest.130.desc
	picture = GFX_evt_announcement
	show_sound = event_announcement
	location = root

	pre_triggers = {
		has_owner = yes
	}
	
	trigger = {
		owner = {
			is_country_type = default
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
		exists = controller
		controller = { is_same_value = root.owner }
		planet_stability < @stabilitylevel2
		NOR = {
			has_planet_flag = recent_unrest_event
			OR = {
				has_modifier = riots_averted
				has_modifier = spiritualist_unrest
				has_modifier = authoritarian_unrest
				has_modifier = materialist_unrest
				has_modifier = xenophobe_unrest
				has_modifier = xenophile_unrest
				has_modifier = pacifist_unrest
				has_modifier = militarist_unrest
				has_modifier = authoritarian_unrest
				has_modifier = egalitarian_unrest
				has_modifier = capitalism_unrest
				has_modifier = socialism_unrest
				has_modifier = major_terrorist_action
				has_modifier = minor_terrorist_action
			}
		}
	}

	mean_time_to_happen = {
		years = 50
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel2
		}	
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel1
		}
	}

	immediate = {
		add_modifier = {
			modifier = materialist_unrest
			days = 7200 # 20 years
		}
		set_timed_planet_flag = {
			flag = recent_unrest_event
			days = 720
		}
	}

	option = {
		name = OK
		tooltip = {
			add_modifier = {
				modifier = materialist_unrest
				days = 7200 # 20 years
			}
		}
	}
}

planet_event = {
	id = unrest.135
	title = unrest.135.name
	desc = unrest.135.desc
	picture = GFX_evt_alien_segregation
	show_sound = event_public_unrest
	location = root

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
	}

	trigger = {
		has_orbital_bombardment = no
		owner = {
			is_country_type = default
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
		exists = controller
		controller = { is_same_value = root.owner }
		planet_stability < @stabilitylevel2

		any_owned_pop = {
			NOT = {
				is_same_species = owner
			}
		}
		any_owned_pop = {
			is_same_species = owner
		}
		NOR = {
			has_planet_flag = recent_unrest_event
			OR = {
				has_modifier = riots_averted
				has_modifier = spiritualist_unrest
				has_modifier = authoritarian_unrest
				has_modifier = materialist_unrest
				has_modifier = xenophobe_unrest
				has_modifier = xenophile_unrest
				has_modifier = pacifist_unrest
				has_modifier = militarist_unrest
				has_modifier = authoritarian_unrest
				has_modifier = egalitarian_unrest
				has_modifier = capitalism_unrest
				has_modifier = socialism_unrest
				has_modifier = major_terrorist_action
				has_modifier = minor_terrorist_action
			}
		}
	}

	mean_time_to_happen = {
		years = 50
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel2
		}	
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel1
		}
	}

	immediate = {
		add_modifier = {
			modifier = xenophile_unrest
			days = 7200 # 20 years
		}
		set_timed_planet_flag = {
			flag = recent_unrest_event
			days = 720
		}
	}

	option = {
		name = OK
		tooltip = {
			add_modifier = {
				modifier = xenophile_unrest
				days = 7200 # 20 years
			}
		}
	}
}

planet_event = {
	id = unrest.140
	title = unrest.140.name
	desc = unrest.140.desc
	picture = GFX_evt_announcement
	show_sound = event_announcement
	location = root

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
	}

	trigger = {
		has_orbital_bombardment = no
		owner = {
			is_country_type = default
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
		exists = controller
		controller = { is_same_value = root.owner }
		planet_stability < @stabilitylevel2
		NOR = {
			has_planet_flag = recent_unrest_event
			OR = {
				has_modifier = riots_averted
				has_modifier = spiritualist_unrest
				has_modifier = authoritarian_unrest
				has_modifier = materialist_unrest
				has_modifier = xenophobe_unrest
				has_modifier = xenophile_unrest
				has_modifier = pacifist_unrest
				has_modifier = militarist_unrest
				has_modifier = authoritarian_unrest
				has_modifier = egalitarian_unrest
				has_modifier = capitalism_unrest
				has_modifier = socialism_unrest
				has_modifier = major_terrorist_action
				has_modifier = minor_terrorist_action
			}
		}
	}

	mean_time_to_happen = {
		years = 50
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel2
		}	
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel1
		}
	}

	immediate = {
		add_modifier = {
			modifier = egalitarian_unrest
			days = 7200 # 20 years
		}
		set_timed_planet_flag = {
			flag = recent_unrest_event
			days = 720
		}
	}

	option = {
		name = OK
		every_owned_pop = {
			tooltip = {
				add_modifier = {
					modifier = egalitarian_unrest
					days = 7200 # 20 years
				}
			}
		}
	}
}

planet_event = {
	id = unrest.145
	title = unrest.145.name
	desc = unrest.145.desc
	picture = GFX_evt_announcement
	show_sound = event_announcement
	location = root

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
	}

	trigger = {
		has_orbital_bombardment = no
		owner = {
			is_country_type = default
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
		exists = controller
		controller = { is_same_value = root.owner }
		planet_stability < @stabilitylevel2
		NOR = {
			has_planet_flag = recent_unrest_event
			OR = {
				has_modifier = riots_averted
				has_modifier = spiritualist_unrest
				has_modifier = authoritarian_unrest
				has_modifier = materialist_unrest
				has_modifier = xenophobe_unrest
				has_modifier = xenophile_unrest
				has_modifier = pacifist_unrest
				has_modifier = militarist_unrest
				has_modifier = authoritarian_unrest
				has_modifier = egalitarian_unrest
				has_modifier = capitalism_unrest
				has_modifier = socialism_unrest
				has_modifier = major_terrorist_action
				has_modifier = minor_terrorist_action
			}
		}
	}

	mean_time_to_happen = {
		years = 50
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel2
		}	
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel1
		}
	}

	immediate = {
		add_modifier = {
			modifier = pacifist_unrest
			days = 7200 # 20 years
		}
		set_timed_planet_flag = {
			flag = recent_unrest_event
			days = 720
		}
	}

	option = {
		name = OK
		tooltip = {
			add_modifier = {
				modifier = pacifist_unrest
				days = 7200 # 20 years
			}
		}
	}
}

planet_event = {
	id = unrest.150
	title = unrest.150.name
	desc = unrest.150.desc
	picture = GFX_evt_victorious_army
	show_sound = event_alien_signal
	location = root

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
	}

	trigger = {
		has_orbital_bombardment = no
		owner = {
			is_country_type = default
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
		exists = controller
		controller = { is_same_value = root.owner }
		planet_stability < @stabilitylevel2
		NOR = {
			has_planet_flag = recent_unrest_event
			OR = {
				has_modifier = riots_averted
				has_modifier = spiritualist_unrest
				has_modifier = authoritarian_unrest
				has_modifier = materialist_unrest
				has_modifier = xenophobe_unrest
				has_modifier = xenophile_unrest
				has_modifier = pacifist_unrest
				has_modifier = militarist_unrest
				has_modifier = authoritarian_unrest
				has_modifier = egalitarian_unrest
				has_modifier = capitalism_unrest
				has_modifier = socialism_unrest
				has_modifier = major_terrorist_action
				has_modifier = minor_terrorist_action
			}
		}
	}

	mean_time_to_happen = {
		years = 50
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel2
		}	
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel1
		}
	}

	immediate = {
		add_modifier = {
			modifier = militarist_unrest
			days = 7200 # 20 years
		}
		set_timed_planet_flag = {
			flag = recent_unrest_event
			days = 720
		}
	}

	option = {
		name = OK
		tooltip = { 
			add_modifier = {
				modifier = militarist_unrest
				days = 7200 # 20 years
			}
		}
	}
}

planet_event = {
	id = unrest.5000
	title = unrest.5000.name
	desc = unrest.5000.desc
	picture = GFX_evt_victorious_army
	show_sound = event_alien_signal
	location = root

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
	}

	trigger = {
		has_orbital_bombardment = no
		owner = {
			is_country_type = default
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
		exists = controller
		controller = { is_same_value = root.owner }
		planet_stability < @stabilitylevel2
		NOR = {
			has_planet_flag = recent_unrest_event
			OR = {
				has_modifier = riots_averted
				has_modifier = spiritualist_unrest
				has_modifier = authoritarian_unrest
				has_modifier = materialist_unrest
				has_modifier = xenophobe_unrest
				has_modifier = xenophile_unrest
				has_modifier = pacifist_unrest
				has_modifier = militarist_unrest
				has_modifier = authoritarian_unrest
				has_modifier = egalitarian_unrest
				has_modifier = capitalism_unrest
				has_modifier = socialism_unrest
				has_modifier = major_terrorist_action
				has_modifier = minor_terrorist_action
			}
		}
	}

	mean_time_to_happen = {
		years = 50
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel2
		}	
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel1
		}
	}

	immediate = {
		add_modifier = {
			modifier = socialism_unrest
			days = 7200 # 20 years
		}
		set_timed_planet_flag = {
			flag = recent_unrest_event
			days = 720
		}
	}

	option = {
		name = OK
		tooltip = { 
			add_modifier = {
				modifier = socialism_unrest
				days = 7200 # 20 years
			}
		}
	}
}

planet_event = {
	id = unrest.6000
	title = unrest.6000.name
	desc = unrest.6000.desc
	picture = GFX_evt_victorious_army
	show_sound = event_alien_signal
	location = root

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
	}

	trigger = {
		has_orbital_bombardment = no
		owner = {
			is_country_type = default
			NOT = { has_ethic = ethic_gestalt_consciousness }
		}
		exists = controller
		controller = { is_same_value = root.owner }
		planet_stability < @stabilitylevel2
		NOR = {
			has_planet_flag = recent_unrest_event
			OR = {
				has_modifier = riots_averted
				has_modifier = spiritualist_unrest
				has_modifier = authoritarian_unrest
				has_modifier = materialist_unrest
				has_modifier = xenophobe_unrest
				has_modifier = xenophile_unrest
				has_modifier = pacifist_unrest
				has_modifier = militarist_unrest
				has_modifier = authoritarian_unrest
				has_modifier = egalitarian_unrest
				has_modifier = capitalism_unrest
				has_modifier = socialism_unrest
				has_modifier = major_terrorist_action
				has_modifier = minor_terrorist_action
			}
		}
	}

	mean_time_to_happen = {
		years = 50
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel2
		}	
		modifier = {
			factor = 0.8
			planet_stability < @stabilitylevel1
		}
	}

	immediate = {
		add_modifier = {
			modifier = capitalism_unrest
			days = 7200 # 20 years
		}
		set_timed_planet_flag = {
			flag = recent_unrest_event
			days = 720
		}
	}

	option = {
		name = OK
		tooltip = { 
			add_modifier = {
				modifier = capitalism_unrest
				days = 7200 # 20 years
			}
		}
	}
}

# SLAVE REVOLT CHAIN #

# Stirrings
planet_event = {
	id = unrest.155
	title = unrest.155.name
	desc = unrest.155.desc
	picture = GFX_evt_alien_propaganda
	show_sound = event_planetary_riot
	location = root

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
	}

	trigger = {
		owner = { is_country_type = default }
		exists = controller
		controller = { is_same_value = root.owner }
		planet_stability < @stabilitylevel3
		has_orbital_bombardment = no
 		any_owned_pop = {
			NOT = { has_trait = trait_mechanical }
			is_sapient = yes
			is_enslaved = yes
		}
		NOR = {
			has_planet_flag = slave_stirring
			has_planet_flag = recent_unrest_event
			has_modifier = slave_hunger_strike 
			has_modifier = slave_riots
			has_modifier = adding_unrest_slaves
			has_modifier = revolt_suppressed
		}
	}

	mean_time_to_happen = { years = 50 }

	immediate = {
		add_modifier = {
			modifier = adding_unrest_slaves
			days = 7200
		}
		set_timed_planet_flag = {
			flag = recent_unrest_event
			days = 720
		}
		set_planet_flag = slave_revolt_chain_active
		set_timed_planet_flag = {
			flag = slave_stirring
			days = 7200
		}
		root.owner = { set_country_flag = slave_revolt_chain_active }
		save_event_target_as = revolt_planet
		planet_event = { id = unrest.170 days = 720 random = 10 }
	}

	option = {
		name = unrest.155.a
	}
}

# Chain Gatekeeper Event
planet_event = {
	id = unrest.170
	hide_window = yes
	is_triggered_only = yes

	pre_triggers = {
		has_owner = yes
		has_ground_combat = no
	}

	trigger = {
		owner = {
			is_country_type = default
			has_country_flag = slave_revolt_chain_active
		}
		exists = controller
		controller = { is_same_value = root.owner }
		has_orbital_bombardment = no
	}
	immediate = {
		# Fire Resistance
		if = {
			limit = {
				planet_stability < @stabilitylevel2
 				any_owned_pop = {
					not = { has_trait = trait_mechanical }
					is_sapient = yes
					is_enslaved = yes
				}
				has_planet_flag = slave_stirring
				NOR = {
					has_planet_flag = slave_resistance
					has_planet_flag = recent_unrest_event
				}
			}
			planet_event = { id = unrest.158 }
		}
		# Fire Riots
		if = {
			limit = {
				planet_stability < @stabilitylevel1
 				any_owned_pop = {
 					not = { has_trait = trait_mechanical }
					is_sapient = yes
					is_enslaved = yes
				}
				has_planet_flag = slave_resistance
				NOR = {
					has_planet_flag = slave_riots
					has_planet_flag = recent_unrest_event
				}
			}
			planet_event = { id = unrest.157 }
		}
		# Fire Revolt
		if = {
			limit = {
				planet_stability < @stabilitylevel1
				check_variable = {
					which = unrest_50
					value > 36
				}
				has_planet_flag = slave_riots
 				any_owned_pop = {
 					not = { has_trait = trait_mechanical }
					is_sapient = yes
					is_enslaved = yes
				}
				NOR = { 
					has_planet_flag = slave_revolt
					has_planet_flag = recent_unrest_event
				}
			}
			planet_event = { id = unrest.160 }
			set_variable = {
				which = unrest_50
				value = 0
			}
		}
		planet_event = { id = unrest.170 days = 60 }
	}
}
# Resistance gatekeeper event
planet_event = {
	id = unrest.158
	hide_window = yes

	pre_triggers = {
		has_owner = yes
	}
	
	trigger = {
		owner = { is_country_type = default }
		exists = controller
		controller = { is_same_value = root.owner }
		planet_stability < @stabilitylevel2
 		any_owned_pop = {
			not = { has_trait = trait_mechanical }
			is_sapient = yes
			is_enslaved = yes
		}
		has_planet_flag = slave_stirring
		NOR = {
			has_planet_flag = slave_resistance
			has_planet_flag = recent_unrest_event
		}
	}

	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				exists = owner
				owner = { is_country_type = default }
				planet_stability < @stabilitylevel2
				has_modifier = adding_unrest_slaves
 				any_owned_pop = {
					not = { has_trait = trait_mechanical }
					is_sapient = yes
					is_enslaved = yes
				}
			}
			random_list = {
 				50 = {
 					planet_event = { id = unrest.156 }
 				}
 				50 = {
 					planet_event = { id = unrest.159 } 
 				}
 			}
		}
 		else = {
 			planet_event = { id = unrest.159 } 
 		}
		planet_event = { id = unrest.157 days = 721 random = 10 }
 	}
}

# Resistance: Sabotage
planet_event = {
	id = unrest.156
	title = unrest.156.name
	desc = unrest.156.desc
	picture = GFX_evt_night_raid
	show_sound = event_ship_explosion
	location = event_target:revolt_planet

	is_triggered_only = yes

	immediate = {
		add_planet_devastation = 30
		set_timed_planet_flag = {
			flag = recent_unrest_event
			days = 720
		}
		set_timed_planet_flag = { 
			flag = slave_resistance
			days = 3600
		}
	}
	option = {
		name = unrest.156.a
		tooltip = { add_planet_devastation = 30 }
	}
	option = {
		name = unrest.156.b
		tooltip = { add_planet_devastation = 30 }
	}
}
# Resistance: hunger strike 
planet_event = {
	id = unrest.159
	title = unrest.159.name
	desc = unrest.159.desc
	picture = GFX_evt_burning_settlement
	show_sound = event_planetary_riot
	location = root

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			set_timed_planet_flag = {
				flag = recent_unrest_event
				days = 720
			}	
		}
		add_modifier = {
			modifier = slave_hunger_strike
			days = 1800
		}
		set_timed_planet_flag = { 
			flag = slave_resistance
			days = 3600
		}
	}

	option = {
		name = unrest.159.a
		tooltip = {
			add_modifier = {
			modifier = slave_hunger_strike
			days = 1800
			}
		}
	}
	option = {
		name = unrest.159.b
		tooltip = {
			add_modifier = {
			modifier = slave_hunger_strike
			days = 1800
			}
		}
	}
}

# Riots
planet_event = {
	id = unrest.157
	title = unrest.157.name
	desc = unrest.157.desc
	picture = GFX_evt_surrender
	show_sound = event_planetary_riot
	location = root

	pre_triggers = {
		has_owner = yes
	}
	
	trigger = {
		owner = { is_country_type = default }
		exists = controller
		controller = { is_same_value = root.owner }
		planet_stability < @stabilitylevel1
 		any_owned_pop = {
			is_enslaved = yes
		}
		has_planet_flag = slave_resistance
		NOR = {
			has_planet_flag = slave_riots
			has_planet_flag = recent_unrest_event
		}
	}

	is_triggered_only = yes

	immediate = {
		set_timed_planet_flag = {
			flag = recent_unrest_event
			days = 720
		}
		set_timed_planet_flag = {
			flag = slave_riots
			days = 3600
		}

		add_modifier = {
			modifier = slave_riots
			days = 3600
		}
	}	
	option = {
		name = unrest.157.a
		tooltip = {
			add_modifier = {
				modifier = slave_riots
				days = 3600
			}
		}
	}
	option = {
		name = unrest.157.b
		tooltip = {
			add_modifier = {
				modifier = slave_riots
				days = 3600
			}
		}
	}
}

# Revolt
planet_event = {
	id = unrest.160
	title = unrest.160.name
	desc = unrest.160.desc
	picture = GFX_evt_surrender
	show_sound = event_planetary_riot
	location = root

	pre_triggers = {
		has_owner = yes
	}
	
	trigger = {
		owner = { is_country_type = default }
		exists = controller
		controller = { is_same_value = root.owner }
		planet_stability < @stabilitylevel1
		has_planet_flag = slave_riots
 		any_owned_pop = {
			is_enslaved = yes
		}
		NOR = { 
			has_planet_flag = slave_revolt
			has_planet_flag = recent_unrest_event
		}
	}

	is_triggered_only = yes

	immediate = {
		random_owned_pop = {
			limit = {
				is_enslaved = yes
			}
			save_event_target_as = leader_pop
		}
		create_rebels = {
			name = random
			ethos = {
				ethic = "ethic_fanatic_egalitarian"
				ethic = "ethic_militarist"
			}
			authority = auth_democratic
			civics = random
			origin = "origin_separatists"
			species = event_target:leader_pop.species
			flag = random

			effect = {
				set_country_flag = slave_rebels
				save_event_target_as = rebelling_slaves
				establish_communications_no_message = root.owner
				set_relation_flag = {
					flag = rebelling_slaves_former_owner
					who = root.owner
				}
				root = {
					owner = {
						every_relation = {
							limit = { has_communications = prev }
							establish_communications_no_message = prevprevprev
						}
					}
					every_planet_army = {
						limit = { army_type = slave_army }
						set_owner = event_target:rebelling_slaves
					}
					every_owned_pop = {
						limit = {
							is_enslaved = yes
						}
						planet = {
							while = {
								count = 2
								create_army = {
									name = "NAME_Freedom_Fighters"
									owner = event_target:rebelling_slaves
									species = event_target:leader_pop.species
									type = "rebel_slave_defense_army"
								}
							}
						}
					}
				}
				create_leader = {
					class = ruler
					species = owner_main_species
					name = random
					skill = 2
					traits = {}
				}
				assign_leader = last_created_leader
				ruler = {
					add_random_leader_trait = yes
				}
			}
		}

		set_planet_flag = slave_revolt
		set_timed_planet_flag = {
			flag = recent_unrest_event
			days = 720
		}
	}
	
	option = {
		name = unrest.160.a
		custom_tooltip = unrest.160.a.tooltip
	}
}

# Revolt Suppressed #
country_event = {
	id = unrest.161
	title = unrest.161.name
	desc = unrest.161.desc
	picture = GFX_evt_announcement
	show_sound = event_announcement
	location = event_target:revolt_planet

	trigger = {
		is_country_type = default
		FromFrom = {
			has_planet_flag = slave_revolt
			controller = { is_same_value = root }
		}
	}

	is_triggered_only = yes

	immediate = {
		remove_country_flag = slave_revolt_chain_active
		FromFrom = {
			add_modifier = {
				modifier = revolt_suppressed
				days = 3600
			}
			save_event_target_as = revolt_planet
			remove_planet_flag = slave_revolt_chain_active
 			remove_planet_flag = slave_riots
			remove_planet_flag = slave_resistance
			remove_planet_flag = slave_stirring
			remove_planet_flag = slave_revolt
			if = {
				limit = {
					has_modifier = slave_hunger_strike
				}
				remove_modifier = slave_hunger_strike
			}
			if = {
				limit = {
					has_modifier = adding_unrest_slaves
				}
				remove_modifier = adding_unrest_slaves
			}
			if = {
				limit = {
					has_modifier = slave_riots
				}
				remove_modifier = slave_riots
			}
		}
	}

	option = {
		name = unrest.161.a
		tooltip = {
			add_modifier = {
				modifier = revolt_suppressed
				days = 3600
			}
		}
		custom_tooltip = unrest.161.a.tooltip
	}
}

# Triggers country_event for the defender upon defeat
# This = country, planet owner
# From = country, attack leader
# FromFrom = planet
# Revolt Lost #
country_event = {
	id = unrest.167
	title = unrest.167.name
	desc = unrest.167.desc
	picture = GFX_evt_surrender
	show_sound = event_air_raid_siren
	location = event_target:revolt_planet

	is_triggered_only = yes

	trigger = {
		From = { is_country_type = rebel }
		FromFrom = {
			has_planet_flag = slave_revolt
		}
	}

	immediate = {
		FromFrom = {
			save_event_target_as = revolt_planet
			remove_planet_flag = slave_revolt_chain_active
 			remove_planet_flag = slave_riots
			remove_planet_flag = slave_resistance
			remove_planet_flag = slave_stirring
			remove_planet_flag = slave_revolt
			if = {
				limit = {
					has_modifier = slave_hunger_strike
				}
				remove_modifier = slave_hunger_strike
			}
			if = {
				limit = {
					has_modifier = adding_unrest_slaves
				}
				remove_modifier = adding_unrest_slaves
			}
			if = {
				limit = {
					has_modifier = slave_riots
				}
				remove_modifier = slave_riots
			}

			kill_leader = { type = governor }
		}
		From = { save_event_target_as = rebel_country }
		remove_country_flag = slave_revolt_chain_active
		save_event_target_as = old_owner
		fromfrom.solar_system = {
			if = {
				limit = {
					exists = starbase
				}
				starbase = {
					set_owner = event_target:rebel_country
				}
			}
			add_claims = {
				who = event_target:old_owner
				num_of_claims = 1
				show_notification = no
			}
		}
		
		if = {
			limit = {
				any_country = {
					OR = {
						has_ethic = ethic_fanatic_egalitarian
						has_ethic = ethic_egalitarian
					}
					has_policy_flag = slavery_not_allowed
					is_country_type = default
					has_communications = ROOT
					any_owned_planet = {
						distance = {
   							source = FromFrom
  							max_distance <= 300
  							min_distance >= 0
 						}
 					}
 					NOR = {
 						is_in_federation_with = ROOT
 						is_same_value = ROOT
 					}
				}
			}
			random_country = {
				limit = {
					OR = {
						has_ethic = ethic_fanatic_egalitarian
						has_ethic = ethic_egalitarian
					}
					has_policy_flag = slavery_not_allowed
					has_communications = ROOT
					is_country_type = default
					any_owned_planet = {
						distance = {
   							source = FromFrom
  							max_distance <= 300
  							min_distance >= 0
 						}
 					}
 					NOR = {
 						is_in_federation_with = ROOT
 						is_same_value = ROOT
 					}
				}
				country_event = { id = unrest.168 days = 4 }
			}
		}	
	}

	option = {
		name = unrest.167.a
	}
	option = {
		name = unrest.167.b
	}
}

# Defect request #
country_event = {
	id = unrest.168
	desc = unrest.168.desc
	location = event_target:revolt_planet
	title = TRANSMISSION
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:rebel_country
		planet_background = event_target:rebel_country.capital_scope
		city_level = event_target:rebel_country.capital_scope
		room = event_target:rebel_country.ruler
	}

	trigger =  {
		exists = event_target:old_owner
	}

	immediate = {
		save_event_target_as = new_owner
	}

	is_triggered_only = yes

	option = {
		name = unrest.168.a
		ai_chance = {
			factor = 100
		}
		event_target:revolt_planet = {
			set_owner = ROOT
			solar_system = {
				if = {
					limit = {
						exists = starbase
					}
					starbase = {
						set_owner = root
					}
				}
			}
		}
		hidden_effect = { 
			event_target:old_owner = { country_event = { id = unrest.169 } }
			event_target:rebel_country = { set_country_flag = silence_destroy_event }
			event_target:rebel_country = { destroy_country = yes }
		}
		custom_tooltip = unrest.168.a.tooltip
		event_target:revolt_planet = {
			add_modifier = {
				modifier = slaves_defected 
				days = 7200
			}
		}
	}

	option = {
		name = unrest.168.b
		ai_chance = {
			factor = 0
		}
	}
}

# Slaves Defect Diplomatic Message #
country_event = {
	id = unrest.169
	desc = unrest.169.desc
	location = event_target:revolt_planet
	title = TRANSMISSION
	diplomatic = yes
	
	picture_event_data = {
		portrait = from
		planet_background = from.capital_scope
		#graphical_culture = event_target:book_writer
		city_level = from.capital_scope
		room = from.ruler
	}

	is_triggered_only = yes

	option = {
		name = unrest.169.a
		add_opinion_modifier = {
			modifier = opinion_took_in_rebels
			who = from
		}
	}
	option = {
		name = unrest.169.b
		add_opinion_modifier = {
			modifier = opinion_took_in_rebels
			who = from
		}
	}
	option = {
		name = unrest.169.c
		add_opinion_modifier = {
			modifier = opinion_took_in_rebels
			who = from
		}
	}
}

# End chain if no more slaves #
event = {
	id = unrest.162
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		any_country = {
			is_country_type = default
			has_country_flag = slave_revolt_chain_active
			any_owned_planet = {
				has_planet_flag = slave_revolt_chain_active
				controller = { is_same_value = owner }
			}
		}
	}

	immediate = {
		every_country = {
			limit = {
				is_country_type = default
				has_country_flag = slave_revolt_chain_active
				any_owned_planet = {
					has_planet_flag = slave_revolt_chain_active
				}
			}
			every_owned_planet = {
				limit = {
					has_planet_flag = slave_revolt_chain_active
					NOT = {
						any_owned_pop = {
							is_enslaved = yes
						}
					}
				}
				planet_event = { id = unrest.163 }
			}
		}
	}
}

# Slave Labor Discontinued

planet_event = {
	id = unrest.163
	title = unrest.163.name
	desc = unrest.163.desc
	picture = GFX_evt_announcement
	show_sound = event_announcement
	location = root
	is_triggered_only = yes

	immediate = {
		save_event_target_as = revolt_planet
		remove_planet_flag = slave_revolt_chain_active
 		remove_planet_flag = slave_riots
		remove_planet_flag = slave_resistance
		remove_planet_flag = slave_stirring
		remove_planet_flag = slave_revolt
		if = {
				limit = {
					has_modifier = slave_hunger_strike
				}
				remove_modifier = slave_hunger_strike
			}
			if = {
				limit = {
					has_modifier = adding_unrest_slaves
				}
				remove_modifier = adding_unrest_slaves
			}
			if = {
				limit = {
					has_modifier = slave_riots
				}
				remove_modifier = slave_riots
			}
		root.owner = { remove_country_flag = slave_revolt_chain_active }
	}
	option = {
		name = EXCELLENT
	}
}

# Planet Pacified #
event = {
	id = unrest.164
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		any_country = {
			is_country_type = default
			has_country_flag = slave_revolt_chain_active
			any_owned_planet = {
				has_planet_flag = slave_revolt_chain_active
				planet_stability >= @stabilitylevel3
				NOR = {
					has_modifier = slave_hunger_strike
					has_modifier = adding_unrest_slaves
					has_modifier = slave_riots
				}
			}
		}
	}

	immediate = { 
		every_country = {
			limit = {
				is_country_type = default
				has_country_flag = slave_revolt_chain_active
				any_owned_planet = {
					has_planet_flag = slave_revolt_chain_active
					planet_stability >= @stabilitylevel3
					NOR = {
						has_modifier = slave_hunger_strike
						has_modifier = adding_unrest_slaves
						has_modifier = slave_riots
					}
				}
			}
			every_owned_planet = {
				limit = {
					AND = {
						has_planet_flag = slave_revolt_chain_active
						planet_stability >= @stabilitylevel3
						NOR = {
							has_modifier = slave_hunger_strike
							has_modifier = adding_unrest_slaves
							has_modifier = slave_riots
						}
					}	
				}
				planet_event = { id = unrest.165 }
			}	 
		}
	}
}

planet_event = {
	id = unrest.165
	title = unrest.165.name
	desc = unrest.165.desc
	picture = GFX_evt_surrender
	show_sound = event_administrative_work
	location = root
	is_triggered_only = yes

	immediate = {
		save_event_target_as = revolt_planet
		remove_planet_flag = slave_revolt_chain_active
 		remove_planet_flag = slave_riots
		remove_planet_flag = slave_resistance
		remove_planet_flag = slave_stirring
		remove_planet_flag = slave_revolt
		root.owner = { remove_country_flag = slave_revolt_chain_active }
	}
	option = {
		name = OK
	}
}

# Revolt Gatekeeper : unrest needs to be >50 for 3 years before trggering revolt
event = {
	id = unrest.166
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		any_country = {
			is_country_type = default
			any_owned_planet = {
				#has_planet_flag = slave_riots
				OR = {
					has_planet_flag = unrest_50_variable_set
					planet_stability < @stabilitylevel2
				}
			}
		}
	}

	immediate = {
		every_galaxy_planet = {
			limit = {
				is_colony = yes
				OR = {
					#has_planet_flag = slave_riots
					has_planet_flag = unrest_50_variable_set
					planet_stability < @stabilitylevel2
				}
			}
			if = {
				limit = {
					NOT = { has_planet_flag = unrest_50_variable_set }
					planet_stability < @stabilitylevel2
				}
				set_planet_flag = unrest_50_variable_set
				set_variable = {
					which = unrest_50
					value = 1
				}
			}
			else_if = {
				limit = {
					has_planet_flag = unrest_50_variable_set
					planet_stability < @stabilitylevel2
				}
				change_variable = {
					which = unrest_50
					value = 1
				}
			}
			else_if = {
				limit = {
					has_planet_flag = unrest_50_variable_set
					planet_stability >= @stabilitylevel2
				}
				set_variable = {
					which = unrest_50
					value = 0
				}
			}
		}
	}
}

country_event = { #Removes the "Free at Last" modifier when the planet is conquered or reconquered
	id = unrest.171
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		fromfrom = {
			OR = {
				has_modifier = slaves_defected
				has_modifier = insurgents_free
				has_modifier = free_at_last #No longer in use but for backwards comp
			}
		}
	}

	immediate = {
		fromfrom = {
			if = {
				limit = { has_modifier = slaves_defected }
				remove_modifier = slaves_defected
			}
			if = {
				limit = { has_modifier = insurgents_free }
				remove_modifier = insurgents_free
			}
			if = {
				limit = { has_modifier = free_at_last }
				remove_modifier = free_at_last
			}
		}
	}
}

######## SECESSION/NATIONALIST REVOLT ##########

# check if original_owner matches any pop on planet, if so defect to them, otherwise form independent nation

# on battle won check previous_owner and original_owner to determine if they should desire return or independence

situation_event = {
	id = unrest.4200
	title = unrest.4200.name
	desc = {
		trigger = {
			owner = { is_regular_empire = yes }
			NOT = { exists = event_target:new_owner_empire }
		}
		text = unrest.4200.desc.regular_no_join
	}
	desc = {
		trigger = {
			owner = { is_regular_empire = yes }
			exists = event_target:new_owner_empire
		}
		text = unrest.4200.desc.regular_join
	}
	desc = {
		trigger = {
			owner = { is_hive_empire = yes }
			NOT = { exists = event_target:new_owner_empire }
			event_target:rebel_empire = { is_hive_empire = yes }
		}
		text = unrest.4200.desc.hive_no_join
	}
	desc = {
		trigger = {
			owner = { is_hive_empire = yes }
			NOT = { exists = event_target:new_owner_empire }
			event_target:rebel_empire = { is_hive_empire = no }
		}
		text = unrest.4200.desc.hive_no_join_regular
	}
	desc = {
		trigger = {
			owner = { is_hive_empire = yes }
			exists = event_target:new_owner_empire
		}
		text = unrest.4200.desc.hive_join
	}
	desc = {
		trigger = {
			owner = { is_machine_empire = yes }
			NOT = { exists = event_target:new_owner_empire }
			event_target:rebel_empire = { is_machine_empire = yes }
		}
		text = unrest.4200.desc.machine_no_join
	}
	desc = {
		trigger = {
			owner = { is_machine_empire = yes }
			NOT = { exists = event_target:new_owner_empire }
			event_target:rebel_empire = { is_machine_empire = no }
		}
		text = unrest.4200.desc.machine_no_join_regular
	}
	desc = {
		trigger = {
			owner = { is_machine_empire = yes }
			exists = event_target:new_owner_empire
		}
		text = unrest.4200.desc.machine_join
	}
	picture = GFX_evt_surrender
	show_sound = event_ground_battle
	location = root.target
	situation = this

	is_triggered_only = yes

	immediate = {
		save_event_target_as = revolt_situation
		owner = {
			save_event_target_as = old_owner
			if = {
				limit = { is_ai = yes }
				log = "AI [This.GetName] suffered a rebellion on [Root.Target.GetName] in [GetYear]"
			}
			else = {
				log = "Player [This.GetName] suffered a rebellion on [Root.Target.GetName] in [GetYear]"
			}
		}
		target = {
			random_owned_species = {
				limit = { has_species_flag = rebellion_species@root }
				save_event_target_as = rebellion_species
			}
		}
		if = {
			limit = { NOT = { exists = event_target:rebellion_species } }
			deduce_planetary_separatism_species = yes
		}
		random_country = {
			limit = {
				has_country_flag = revolt_joiner_empire_@root
				#Check eligibility again in case there are pacts in the meantime or something went wrong
				basic_eligibility_for_separatism_joining_trigger = yes
			}
			save_event_target_as = new_owner_empire
		}

		target = {
			save_event_target_as = rebel_planet
			create_rebels = {
				name = random
				ethos = random
				authority = random
				civics = random
				origin = "origin_separatists"
				species = event_target:rebellion_species
				flag = random
				effect = {
					set_country_type = default #we don't need the rebel country type with this version, but create_rebels effect has useful functionalities
					save_event_target_as = rebel_empire
					if = {
						limit = {
							has_trait = trait_necrophage
						}
						set_origin = origin_necrophage
					}
					else_if = {
						limit = {
							has_trait = trait_void_dweller_1
						}
						set_origin = origin_void_dwellers
					}
					else_if = {
						limit = {
							has_trait = trait_cave_dweller
						}
						set_origin = origin_subterranean
					}
					else_if = {
						limit = {
							root.owner = { has_origin = origin_tree_of_life }
							has_trait = trait_hive_mind
						}
						set_origin = origin_tree_of_life
					}

					if = {
						limit = {
							OR = {
								has_trait = trait_machine_unit
								has_trait = trait_hive_mind
							}
							NOT = { has_ethic = ethic_gestalt_consciousness }
						}
						shift_ethic = ethic_gestalt_consciousness
						change_government = random
					}
					else = {
						root = {
							switch = {
								trigger = has_situation_flag
								pacifist = {
									event_target:rebel_empire = {
										shift_ethic = ethic_fanatic_pacifist
									}
								}
								militarist = {
									event_target:rebel_empire = {
										shift_ethic = ethic_fanatic_militarist
									}
								}
								authoritarian = {
									event_target:rebel_empire = {
										shift_ethic = ethic_fanatic_authoritarian
									}
								}
								egalitarian = {
									event_target:rebel_empire = {
										shift_ethic = ethic_fanatic_egalitarian
									}
								}
								xenophile = {
									event_target:rebel_empire = {
										shift_ethic = ethic_fanatic_xenophile
									}
								}
								xenophobe = {
									event_target:rebel_empire = {
										shift_ethic = ethic_fanatic_xenophobe
									}
								}
								spiritualist = {
									event_target:rebel_empire = {
										shift_ethic = ethic_fanatic_spiritualist
									}
								}
								materialist = {
									event_target:rebel_empire = {
										shift_ethic = ethic_fanatic_materialist
									}
								}
								socialism = {
									event_target:rebel_empire = {
										shift_ethic = ethic_fanatic_socialism
									}
								}
								capitalism = {
									event_target:rebel_empire = {
										shift_ethic = ethic_fanatic_capitalism
									}
								}
							}
						}
						change_government = {
							authority = random
							civics = random
						}
					}

					create_leader = {
						class = ruler
						species = owner_main_species
						name = random
						skill = 5
						effect = {
							event_target:rebel_empire = { assign_leader = prev }
							add_random_leader_trait = yes
							add_random_leader_trait = yes
						}
					}

					establish_communications_no_message = root.owner
					if = {
						limit = { exists = event_target:new_owner_empire }
						establish_communications_no_message = event_target:new_owner_empire
					}
					event_target:rebel_planet = { #Flip the target planet
						set_owner = event_target:rebel_empire
						add_modifier = {
							modifier = insurgents_free
							days = 7200
						}

						solar_system = {
							if = {
								limit = { exists = starbase }
								starbase = {
									set_owner = event_target:rebel_empire
									if = {
										limit = { has_starbase_size = starbase_outpost }
										set_starbase_size = starbase_starport
										set_starbase_module = {
											slot = 1
											module = shipyard
										}
										set_starbase_module = {
											slot = 2
											module = shipyard
										}
									}
									else_if = {
										limit = {
											NOT = { has_starbase_module = shipyard }
										}
										set_starbase_module = {
											slot = 1
											module = shipyard
										}
										set_starbase_module = {
											slot = 2
											module = shipyard
										}
									}
								}
							}
							else = {
								create_starbase = {
									size = starbase_starport
									module = shipyard
									module = shipyard
									owner = event_target:rebel_empire
								}
							}
							add_claims = {
								who = root.owner
								show_notification = no
							}
							every_system_planet = {
								limit = {
									is_colony = yes
									NOT = { is_same_value = event_target:rebel_planet }
								}
								set_owner = event_target:rebel_empire
							}
							every_fleet_in_system = {
								limit = { is_owned_by = root.owner }
								set_mia = yes
							}
						}
					}
					root.owner = {
						every_owned_planet = { #Flip the additional joiner planets
							limit = {
								has_modifier = instability_join_revolt
								planet_stability < @[ stabilitylevel2 + 10 ]
							}
							if = { #if you check this in the original limit of every_owned_planet, it calcs it before the loop is executed. Which means it will set the owner of the system twice if there are two colonies in the system.
								limit = {
									exists = controller
									controller = { is_same_value = root.owner }
								}
								remove_modifier = instability_join_revolt
								set_owner = event_target:rebel_empire
								add_modifier = {
									modifier = insurgents_free
									days = 7200
								}

								solar_system = {
									if = {
										limit = { exists = starbase }
										starbase = { set_owner = event_target:rebel_empire }
									}
									add_claims = {
										who = root.owner
										show_notification = no
									}
									every_system_planet = {
										limit = {
											is_colony = yes
											NOT = { is_same_value = prevprev }
										}
										set_owner = event_target:rebel_empire
									}
									every_fleet_in_system = {
										limit = { is_owned_by = root.owner }
										set_mia = yes
									}
								}
							}
						}
					}
					every_system_within_border = { #Add a few systems
						every_neighbor_system = {
							limit = {
								exists = owner
								owner = { is_same_value = root.owner }
								exists = starbase
								NOR = {
									starbase = { is_starbase_type = sfortress }
									any_system_planet = {
										is_colony = yes
									}
								}
							}
							starbase = { set_owner = event_target:rebel_empire }
							add_claims = {
								who = root.owner
								show_notification = no
							}
							every_fleet_in_system = {
								limit = { is_owned_by = root.owner }
								set_mia = yes
							}
						}
					}
					while = { #Get rid of bordergore systems
						limit = { #Note: system_within_border caching is quite funky at a time like this when many borders are changing hands. The starbase ownership is checked to be extra sure, since it is not cached (unlike system ownership - though that probably would have worked too)
							root.owner = {
								any_system_within_border = {
									exists = starbase
									starbase.owner = { is_same_value = prevprev }
									count_neighbor_system = {
										count >= 2
										limit = {
											exists = starbase.owner
											starbase.owner = {
												is_same_value = event_target:rebel_empire
											}
										}
									}
									NOR = {
										starbase = { is_starbase_type = sfortress }
										any_system_planet = {
											is_colony = yes
										}
									}
								}
							}
						}
						root.owner = {
							every_system_within_border = {
								limit = {
									exists = starbase
									starbase.owner = { is_same_value = prevprev }
									count_neighbor_system = {
										count >= 2
										limit = {
											exists = starbase.owner
											starbase.owner = {
												is_same_value = event_target:rebel_empire
											}
										}
									}
									NOR = {
										starbase = { is_starbase_type = sfortress }
										any_system_planet = {
											is_colony = yes
										}
									}
								}
								starbase = {
									set_owner = event_target:rebel_empire
								}
								add_claims = {
									who = root.owner
									show_notification = no
								}
								every_fleet_in_system = {
									limit = { is_owned_by = root.owner }
									set_mia = yes
								}
							}
						}
					}

					if = {
						limit = { exists = event_target:new_owner_empire }
						set_country_flag = silence_destroy_event
						ruler = {
							save_event_target_as = exiled_rebel
							exile_leader_as = exiled_rebel
						}
						every_owned_starbase = {
							set_owner = event_target:new_owner_empire
						}
						every_owned_planet = {
							set_owner = event_target:new_owner_empire
						}
						country_event = { id = unrest.4220 }
					}
					else = {
						add_resource = {
							minerals = 15000
							energy = 15000
							food = 15000
							consumer_goods = 10000
							alloys = 10000
							rare_crystals = 1000
							volatile_motes = 1000
							exotic_gases = 1000
							influence = 1000
							unity = 10000
						}
						#It copies the traditions and technologies in code

						create_fleet_from_naval_cap = 0.8
					}
				}
			}
		}
	}

	option = {
		name = unrest.4200.A
		trigger = {
			NOT = { exists = event_target:new_owner_empire }
		}
		event_target:rebel_empire = {
			declare_war = {
				target = root.owner
				attacker_war_goal = wg_independence
				name = {
					key = NAME_WAR_OF_REVOLT
					variable_string = "Root.Target.GetName"
				}
			}
		}
		ai_chance = {
			factor = 5
			mult = value:revolt_fleet_comparison_factor
		}
	}
	option = {
		name = unrest.4200.B
		custom_tooltip = unrest.4200.default_tooltip
		trigger = {
			NOT = { exists = event_target:new_owner_empire }
		}
		hidden_effect = {
			#Add truce
			event_target:rebel_empire = {
				set_truce = {
					target = root.owner
					type = liberation
				}
			}
			root.owner = {
				set_truce = {
					target = event_target:rebel_empire
					type = liberation
				}
			}
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 2
				owner = { is_pacifist = yes }
			}
			modifier = {
				factor = 10
				owner = {
					is_at_war = yes
					any_relation = {
						is_at_war_with = prev
						relative_power = {
							who = prev
							value >= superior
							category = fleet
						}
					}
				}
			}
		}
	}
	option = {
		name = UNFORTUNATE
		custom_tooltip = unrest.4200.joiner_tooltip
		trigger = {
			exists = event_target:new_owner_empire
			owner = { is_at_war_with = event_target:new_owner_empire }
		}
	}
	option = {
		name = unrest.4200.A
		trigger = {
			exists = event_target:new_owner_empire
			NOT = { owner = { is_at_war_with = event_target:new_owner_empire } }
		}

		custom_tooltip = unrest.4200.joiner_tooltip
		event_target:new_owner_empire = {
			declare_war = {
				target = root.owner
				attacker_war_goal = wg_humiliation
				name = {
					key = NAME_WAR_OF_REVOLT
					variable_string = "Root.Target.GetName"
				}
			}
		}

		ai_chance = {
			factor = 1
			modifier = {
				factor = 0 #they can't take them on
				count_potential_war_participants = {
					attacker = event_target:new_owner_empire
					defender = root.owner
					side = event_target:new_owner_empire
					limit = {
						relative_power = { #stronger than root.owner
							who = root.owner
							value >= superior
							category = fleet
						}
						count_potential_war_participants = { #and stronger than root.owner's allies
							attacker = event_target:new_owner_empire
							defender = root.owner
							side = root.owner
							limit = {
								relative_power = {
									who = prev
									value >= equivalent
									category = fleet
								}
							}
							count = 0
						}
					}
					count > 0
				}
			}
			modifier = { #these come into play when the empires are equivalent
				factor = 1.5
				owner = { is_militarist = yes }
			}
			modifier = {
				factor = 0.5
				owner = { is_pacifist = yes }
			}
		}
	}
	option = {
		name = unrest.4200.B
		trigger = {
			exists = event_target:new_owner_empire
			NOT = { owner = { is_at_war_with = event_target:new_owner_empire } }
		}

		custom_tooltip = unrest.4200.joiner_tooltip
		owner = {
			set_truce = {
				target = event_target:new_owner_empire
				type = liberation
			}
			hidden_effect = {
				event_target:new_owner_empire = {
					set_truce = {
						target = prev
						type = liberation
					}
				}
			}
		}

		ai_chance = {
			factor = 1
			modifier = {
				factor = 0 #they can definitely take them on
				count_potential_war_participants = {
					attacker = event_target:new_owner_empire
					defender = root.owner
					side = event_target:new_owner_empire
					limit = {
						relative_power = { #stronger than root.owner
							who = root.owner
							value >= equivalent
							category = fleet
						}
					}
					count = 0
				}
			}
		}
	}

	after = {
		hidden_effect = {
			cleanup_separatism_situation = yes
			destroy_situation = this
		}
	}
}

# Initial rebels manage to take control of the planet, happens before the new owner is set, after the war is created.
# This = Rebel Country
# From = Planet
country_event = {
	id = unrest.4210
	hide_window = yes

	is_triggered_only = yes

	trigger = { has_country_flag = standard_unrest_rebels }

	immediate = {
		From = { 
			remove_planet_flag = revolt_in_progress 
			save_event_target_as = nationalist_revolt_planet
			solar_system = {
				if = {
					limit = {
						exists = starbase
					}
					starbase = {
						set_owner = root
					}
				}
			}
		}
		create_leader = {
			class = ruler
			species = owner_main_species
			name = random
			skill = 2
			traits = {}
		}
		assign_leader = last_created_leader
		ruler = {
			add_random_leader_trait = yes
		}
		from.owner = {
			save_event_target_as = rebelled_against
			country_event = { id = unrest.4211 }
		}
		from = {
			add_modifier = { 
				modifier = insurgents_free
				days = 7200
			}
			solar_system = {
				add_claims = {
					who = event_target:rebelled_against
					num_of_claims = 1
					show_notification = no
				}
			}
		}
		if = {
			limit = {
				from = {
					has_planet_flag = nationalist_revolt
				}
			}
			random_country = {
				limit = {
					from = {
						is_original_owner = prev
					}
				}
				save_event_target_as = fatherland
			}
			event_target:fatherland = {
				country_event = { id = unrest.4220 days = 5 } # request incorporation
			}
			from = { remove_planet_flag = nationalist_revolt }
		}
		else = {
			from = { remove_planet_flag = secessionist_revolt }
		}
	}
}

country_event = { # rebels have broken free notification
	id = unrest.4211
	title = unrest.4211.name
	desc = {
		trigger = { has_ethic = ethic_gestalt_consciousness }
		text = unrest.4211.desc
	}
	desc = {
		trigger = { has_ethic = ethic_gestalt_consciousness }
		text = unrest.4211.desc.gesta
	}
	picture = {
		picture = GFX_evt_surrender
		trigger = { NOT = { has_ethic = ethic_gestalt_consciousness } }
	}
	picture = {
		picture = GFX_evt_satellite_in_orbit
		trigger = { has_ethic = ethic_gestalt_consciousness }
	}
	show_sound = event_factions
	location = fromfrom

	is_triggered_only = yes

	option = {
		name = UNFORTUNATE
	}
}

country_event = {
	id = unrest.4220
	title = unrest.4220.name
	desc = unrest.4220.desc
	location = fromfrom

	diplomatic = yes

	picture_event_data = {
		portrait = from
		planet_background = from.capital_scope
		#graphical_culture = from
		city_level = from.capital_scope
		room = from.ruler
	}

	is_triggered_only = yes

	trigger = {
		exists = event_target:rebelled_against
	}

	option = {
		name = unrest.4220.b
		ai_chance = {
			factor = 100
		}
		hidden_effect = {
			fromfrom = {
				solar_system = {
					if = {
						limit = {
							exists = starbase
						}
						starbase = {
							set_owner = root
						}
					}
				}
			}
			from = {
				set_country_flag = silence_destroy_event
				destroy_country = yes
			}
			fromfrom = {
				set_owner = root
			}
			event_target:rebelled_against = {
				country_event = { id = unrest.4230 days = 5 } # were annexed notification
			}
		}
		fromfrom = {
			set_owner = root
		}
	}

	option = {
		name = unrest.4220.a
		trigger = {
			is_subject = no
		}
		ai_chance = {
			factor = 0
		}
		from = {
			set_subject_of = {
				who = root
				subject_type = vassal
			}
		}
		hidden_effect = {
			event_target:rebelled_against = {
				country_event = { id = unrest.4225 } # became vassal notification
			}
		}
	}

	option = {
		name = unrest.4220.c
		ai_chance = {
			factor = 0
		}
	}
}

country_event = {
	id = unrest.4225
	title = unrest.4225.name
	desc = {
		trigger = { NOT = { has_ethic = ethic_gestalt_consciousness } }
		text = unrest.4225.desc
	}
	desc = {
		trigger = { has_ethic = ethic_gestalt_consciousness }
		text = unrest.4225.desc.gesta
	}
	picture = {
		picture = GFX_evt_announcement
		trigger = { NOT = { has_ethic = ethic_gestalt_consciousness } }
	}
	picture = {
		picture = GFX_evt_satellite_in_orbit
		trigger = { has_ethic = ethic_gestalt_consciousness }
	}
	show_sound = event_announcement
	location = fromfromfrom

	is_triggered_only = yes

	option = {
		name = unrest.4225.a
		add_opinion_modifier = {
			modifier = opinion_took_in_rebels
			who = from
		}
	}
}

country_event = {
	id = unrest.4230
	title = unrest.4230.name
	desc = {
		trigger = { NOT = { has_ethic = ethic_gestalt_consciousness } }
		text = unrest.4230.desc
	}
	desc = {
		trigger = { has_ethic = ethic_gestalt_consciousness }
		text = unrest.4230.desc.gesta
	}
	picture = {
		picture = GFX_evt_announcement
		trigger = { NOT = { has_ethic = ethic_gestalt_consciousness } }
	}
	picture = {
		picture = GFX_evt_satellite_in_orbit
		trigger = { has_ethic = ethic_gestalt_consciousness }
	}
	show_sound = event_factions
	location = fromfromfrom

	is_triggered_only = yes

	trigger = {
		event_target:nationalist_revolt_planet = {
			exists = controller
			controller = { is_same_value = prev.owner }
		}
	}

	option = {
		name = unrest.4230.a
		add_opinion_modifier = {
			modifier = opinion_took_in_rebels
			who = from
		}
	}
}

# This = country, planet owner
# From = country, attack leader
# FromFrom = planet

# Revolt Suppressed #
country_event = {
	id = unrest.4235
	title = unrest.4235.name
	desc = {
		trigger = { NOT = { has_ethic = ethic_gestalt_consciousness } }
		text = unrest.4235.desc
	}
	desc = {
		trigger = { has_ethic = ethic_gestalt_consciousness }
		text = unrest.4235.desc.gesta
	}
	picture = {
		picture = GFX_evt_surrender
		trigger = { NOT = { has_ethic = ethic_gestalt_consciousness } }
	}
	picture = {
		picture = GFX_evt_satellite_in_orbit
		trigger = { has_ethic = ethic_gestalt_consciousness }
	}
	show_sound = event_celebration
	location = FromFrom

	trigger = {
		is_country_type = default
		FromFrom = {
			has_planet_flag = revolt_in_progress
			controller = { is_same_value = root }
		}

	}

	is_triggered_only = yes

	immediate = {
		FromFrom = { remove_planet_flag = revolt_in_progress }
	}

	option = {
		name = unrest.4235.a
		FromFrom = {
			add_modifier = {
				modifier = revolt_suppressed_2
				days = 3600
			}
		}
		custom_tooltip = unrest.161.a.tooltip
	}
}